## **Docker: Мультистейджинг, различные уровни зависимостей**

Цель лабораторной: освоить методы создания образов с разными уровнями зависимостей

1. Создать Dockerfile, который будет называться system. В него будут установлены все зависимости для сборки проекта. Как пример голая node нужной версии.
2. Создать Dockerfile Для сборки и назвать его build. В нем будет собираться проект, он должен использовать имедж system. В build нельзя устанавливать никакие дополнительные зависимости, т.е. apk add, apt install и пр. запрещены. В нём можно только скачивать зависимости и делать сборку проекта.
3. Создать Dockerfile, который будет запускать код , который собрался в build. В нем должен быть только инструмент для запуска вашего проекта, как пример для node проекта - npm run start и пр. Если у вас python проект - объединять 2 и 3 шаги - можно. Если вы билдите проект на GO - тогда должен быть только бинарник для запуска.
4. Вся конфигурация выполняется через переменные окружения
5. Использовать базовые легковестные образы - alpine
6. Контейнер должен	запускаться от непривилегированного пользователя
7. После установки всех нужных утилит,	должен очищаться кеш

ТЗ взятого проекта: `https://gitlab.atp-fivt.org/courses-public/golang/golang-2024s/go/-/tree/master/gitfame`


Как проверять:

`docker build -f Dockerfile.system -t gitfame-system .`


`docker build -f Dockerfile.build  -t gitfame-build  .`


`docker build -f Dockerfile.runtime -t gitfame-runtime .`


Потом:


`docker run --rm   -v "$(pwd)":/repo   gitfame-runtime`


**Notes**:
1) Вместо `"$(pwd)"` указывается папка репозитория, которую мы хотим проанализировать через gitfame. Просто я не могу залить на гит вложенный репозиторий. Можно посмотреть статистику текущего склонированного репозитория как в примере, или, условно, добавить папку test_repo, которая является репозиторием на хосте, и написать
`"$(pwd)/test_repo"`
2) В последнем образе мы **должны** делать `apk add git` в силу особенности проекта, т.к. он под капотом вызывает `git blame` и `git ls-tree`, гит здесь также нужен как и бинарь
3) `-v "$(pwd)/test_repo":/repo` по сути единственный способ (как я понял) примонтировать локальную папку, поэтому это нельзя вынести в `ENV=...`, только через docker-compose или скрипты, но сильно это задачу не упростит, так что это тоже особенность взятого проекта
4) Ещё в папке `./gitfame/test/integration/testdata/bundles` есть бандлы тестовых репозиториев, их тоже можно распаковать для проверки работы
